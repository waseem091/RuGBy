<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RuGBy</title>
  <style>
    /* ========================================================================
       GLOBAL VARIABLES & BASE STYLES
       ========================================================================
       This section contains all CSS custom properties (variables) and global
       base styles that apply throughout the entire plugin interface. These
       variables define the design system including colors, shadows, spacing,
       and typography that ensure consistency across all components.
    */
    @import url('https://fonts.googleapis.com/css2?family=Inter+Display:wght@400;500;600;700;800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap');

    :root {
      --primary-50: #f0f4ff;
      --primary-100: #e0ecff;
      --primary-200: #c7d2fe;
      --primary-300: #a5b4fc;
      --primary-400: #818cf8;
      --primary-500: #6366f1;
      --primary-600: #4f46e5;
      --primary-700: #4338ca;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --success-500: #10b981;
      --error-50: #fef2f2;
      --error-200: #fecaca;
      --error-500: #ef4444;
      --warning-500: #f59e0b;
      --surface: #ffffff;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--gray-50) 0%, var(--primary-50) 100%);
      color: var(--gray-900);
      font-size: 14px;
      line-height: 1.5;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ========================================================================
       UTILITY CLASSES - REUSABLE COMPONENTS
       ========================================================================
       These utility classes eliminate redundancy by providing common styling
       patterns used throughout the interface. They handle transitions, hover
       states, and interactive behaviors for consistent user experience.
    */
    .section-base {
      display: flex;
      flex-direction: column;
      background: var(--gray-50);
      border-radius: var(--radius-lg);
      padding: 16px;
      border: 1px solid var(--gray-200);
      transition: var(--transition);
      overflow: hidden;
    }

    .section-base:hover {
      border-color: var(--primary-200);
      box-shadow: var(--shadow-md);
    }

    .interactive-input {
      border: 1.5px solid var(--gray-300);
      border-radius: var(--radius-md);
      background: var(--surface);
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .interactive-input:hover {
      border-color: var(--primary-400);
      box-shadow: var(--shadow-md);
    }

    .interactive-input:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px var(--primary-100);
    }

    .preview-box {
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
      transition: var(--transition);
    }

    .preview-box:hover {
      border-color: var(--primary-300);
      box-shadow: var(--shadow-md);
    }

    .mono-font {
      font-family: 'JetBrains Mono', monospace;
    }

    /* ========================================================================
       MAIN CONTAINER & LAYOUT
       ========================================================================
       This section defines the main plugin container and overall layout structure.
       It establishes the plugin dimensions, background styling, and creates the
       foundation flexbox layout that organizes all functional sections.
    */
    .plugin-container {
      width: 560px;
      height: 420px;
      position: relative;
      background: var(--surface);
      border-radius: var(--radius-xl);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding: 24px;
      gap: 20px;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--gray-200);
    }

    .header-section, .controls-section {
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      gap: 16px;
    }

    .header-section {
      height: 200px;
    }

    .controls-section {
      height: 140px;
    }

    .section-title {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--gray-500);
      margin-bottom: 12px;
      text-align: center;
    }

    /* ========================================================================
       INITIAL & FINAL HEXCODE SECTIONS
       ========================================================================
       These sections handle the input and display of the starting and ending
       hexcode values. They include RGB input fields with validation, real-time
       color previews, and styled containers that provide visual feedback.
    */
    .hexcode-section {
      width: 140px;
    }

    .rgb-inputs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .rgb-input-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .rgb-label {
      font-size: 9px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--gray-600);
      letter-spacing: 0.5px;
    }

    .rgb-input {
      width: 100%;
      height: 32px;
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: var(--gray-900);
    }

    .color-preview {
      flex: 1;
      position: relative;
      height: 80px;
      margin-top: 8px;
    }

    .color-hex-display {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4));
      color: var(--surface);
      padding: 10px 8px;
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      backdrop-filter: blur(4px);
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }

    /* ========================================================================
       GRADIENT PREVIEW SECTION
       ========================================================================
       This section displays a live preview of the color gradient between the
       initial and final hexcodes. It automatically updates when input values
       change and provides visual feedback to help users understand the transition.
    */
    .gradient-section {
      flex: 1;
    }

    .gradient-preview {
      flex: 1;
      height: 100px;
      position: relative;
      margin-top: 8px;
      background: linear-gradient(180deg, #000, #fff);
    }

    /* ========================================================================
       LINK VALUES SECTION
       ========================================================================
       This section provides RGB component linking functionality that allows users
       to synchronize corresponding color channels between initial and final values.
       When linked, changing one value automatically updates its counterpart.
    */
    .link-values-section {
      width: 140px;
    }

    .link-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .link-btn {
      width: 36px;
      height: 70px;
      background: var(--surface);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      position: relative;
      overflow: hidden;
    }

    .link-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent 0%, var(--primary-50) 100%);
      opacity: 0;
      transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .link-btn:hover {
      transform: translateY(-1px);
    }

    .link-btn:hover::before {
      opacity: 1;
    }

    .link-btn.linked {
      background: linear-gradient(135deg, var(--primary-50) 0%, var(--primary-100) 100%);
      border-color: var(--primary-500);
      color: var(--primary-700);
    }

    .link-btn.linked::before {
      opacity: 0;
    }

    .link-icon {
      font-size: 16px;
      position: relative;
      z-index: 1;
    }

    .link-label {
      font-size: 11px;
      font-weight: 700;
      position: relative;
      z-index: 1;
      letter-spacing: 0.5px;
      font-family: 'Inter Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* ========================================================================
       HEXCODE COUNT SECTION
       ========================================================================
       This section calculates and displays the total number of hexcodes that will
       be generated between the initial and final colors. It includes validation
       warnings and provides feedback about spectrum completeness and limitations.
    */
    .count-section {
      flex: 1;
      align-items: center;
    }

    .count-display {
      width: 100%;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--surface) 0%, var(--gray-50) 100%);
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--gray-900);
    }

    .count-warning {
      font-size: 9px;
      color: var(--error-500);
      font-weight: 600;
      text-align: center;
      padding: 4px 6px;
      border-radius: var(--radius-sm);
      background: var(--error-50);
      border: 1px solid var(--error-200);
    }

    /* ========================================================================
       GENERATE SECTION & AUTO-EXPORT
       ========================================================================
       This section contains the main generation controls including the generate
       button, progress tracking, and auto-export format selection (PNG/SVG).
       It manages the generation process and provides user feedback during execution.
    */
    .generate-section {
      width: 140px;
      align-items: center;
    }

    .generate-btn {
      width: 100%;
      height: 48px;
      border: none;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
      color: var(--surface);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 10px;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      font-family: 'Inter Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .generate-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .generate-btn:hover {
      background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .generate-btn:hover::before {
      left: 100%;
    }

    .generate-btn:active {
      transform: translateY(-1px);
    }

    .generate-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: var(--shadow-sm);
    }

    .progress-container {
      width: 100%;
      margin-bottom: 10px;
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .progress-container.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--gray-200);
      border-radius: var(--radius-sm);
      overflow: hidden;
      margin-bottom: 6px;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-500) 0%, var(--primary-600) 50%, var(--primary-700) 100%);
      border-radius: var(--radius-sm);
      width: 0%;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-text {
      font-size: 9px;
      font-weight: 600;
      color: var(--gray-600);
      text-align: center;
    }

    .export-label {
      font-size: 9px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--gray-600);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
    }

    .export-options {
      display: flex;
      gap: 12px;
      align-items: center;
      background: var(--gray-100);
      padding: 8px;
      border-radius: var(--radius-md);
      border: 1px solid var(--gray-200);
    }

    .export-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      color: var(--gray-700);
      font-family: 'Inter Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .export-option:hover {
      color: var(--primary-600);
    }

    .export-radio {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--surface);
      position: relative;
      cursor: pointer;
      transition: var(--transition);
    }

    .export-radio.selected {
      border-color: var(--primary-500);
      background: var(--primary-50);
    }

    .export-radio.selected::after {
      content: '';
      position: absolute;
      top: 2.5px;
      left: 2.5px;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--primary-600);
      transition: var(--transition);
    }

    /* ========================================================================
       TOAST NOTIFICATIONS & UTILITY CLASSES
       ========================================================================
       This section contains toast notification styling for user feedback and
       utility classes like loading states and animations. These provide visual
       feedback during operations and enhance the overall user experience.
    */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
    }

    .loading {
      position: relative;
      overflow: hidden;
      background: var(--gray-400) !important;
      color: transparent !important;
      cursor: not-allowed !important;
      transform: none !important;
      box-shadow: var(--shadow-sm) !important;
    }

    .loading::before {
      display: none !important;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid var(--gray-300);
      border-top: 2px solid var(--surface);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="plugin-container">
    <!-- ========================================================================
         HEADER SECTION - COLOR INPUT & PREVIEW
         ========================================================================
         This section contains the initial hexcode, final hexcode, and gradient
         preview components. It provides the main interface for color input and
         real-time visualization of the color transition between start and end.
    -->
    <div class="header-section">
      <div class="hexcode-section section-base">
        <div class="section-title">Initial Hexcode</div>
        <div class="rgb-inputs">
          <div class="rgb-input-group">
            <div class="rgb-label">RR</div>
            <input type="text" class="rgb-input interactive-input mono-font" id="initial-r" maxlength="2" value="00">
          </div>
          <div class="rgb-input-group">
            <div class="rgb-label">GG</div>
            <input type="text" class="rgb-input interactive-input mono-font" id="initial-g" maxlength="2" value="00">
          </div>
          <div class="rgb-input-group">
            <div class="rgb-label">BB</div>
            <input type="text" class="rgb-input interactive-input mono-font" id="initial-b" maxlength="2" value="00">
          </div>
        </div>
        <div class="color-preview preview-box" id="initial-preview">
          <div class="color-hex-display mono-font" id="initial-hex">#000000</div>
        </div>
      </div>

      <div class="gradient-section section-base">
        <div class="section-title">Gradient Preview</div>
        <div class="gradient-preview preview-box" id="gradient-preview"></div>
      </div>

      <div class="hexcode-section section-base">
        <div class="section-title">Final Hexcode</div>
        <div class="rgb-inputs">
          <div class="rgb-input-group">
            <div class="rgb-label">RR</div>
            <input type="text" class="rgb-input interactive-input mono-font" id="final-r" maxlength="2" value="FF">
          </div>
          <div class="rgb-input-group">
            <div class="rgb-label">GG</div>
            <input type="text" class="rgb-input interactive-input mono-font" id="final-g" maxlength="2" value="FF">
          </div>
          <div class="rgb-input-group">
            <div class="rgb-label">BB</div>
            <input type="text" class="rgb-input interactive-input mono-font" id="final-b" maxlength="2" value="FF">
          </div>
        </div>
        <div class="color-preview preview-box" id="final-preview">
          <div class="color-hex-display mono-font" id="final-hex">#FFFFFF</div>
        </div>
      </div>
    </div>

    <!-- ========================================================================
         CONTROLS SECTION - GENERATION & CONFIGURATION
         ========================================================================
         This section contains all the control elements including link values,
         hexcode count display, and generation controls with export options.
         It manages the user's generation preferences and execution commands.
    -->
    <div class="controls-section">
      <div class="link-values-section section-base">
        <div class="section-title">Link Values</div>
        <div class="link-buttons">
          <button class="link-btn interactive-input" id="link-r" data-component="r">
            <div class="link-icon">🔗</div>
            <div class="link-label">R</div>
          </button>
          <button class="link-btn interactive-input" id="link-g" data-component="g">
            <div class="link-icon">🔗</div>
            <div class="link-label">G</div>
          </button>
          <button class="link-btn interactive-input" id="link-b" data-component="b">
            <div class="link-icon">🔗</div>
            <div class="link-label">B</div>
          </button>
        </div>
      </div>

      <div class="count-section section-base">
        <div class="section-title">Hexcode Count</div>
        <div class="count-display interactive-input mono-font" id="hex-count">1</div>
        <div class="count-warning" id="count-warning">Let's R-G-Begin!</div>
      </div>

      <div class="generate-section section-base">
        <button class="generate-btn" id="generate-btn">Generate</button>
        <div class="progress-container" id="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text mono-font" id="progress-text">Generating colors...</div>
        </div>
        <div class="export-label">Auto-export as</div>
        <div class="export-options">
          <label class="export-option">
            <div class="export-radio interactive-input selected" data-format="png"></div>
            <span>PNG</span>
          </label>
          <label class="export-option">
            <div class="export-radio interactive-input" data-format="svg"></div>
            <span>SVG</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ========================================================================
    // STATE MANAGEMENT & DOM REFERENCES
    // ========================================================================
    // This section manages the global application state and DOM element references.
    // It centralizes all data and UI connections for efficient state management
    // and provides easy access to interface components throughout the application.
    const state = {
      initial: { r: 0, g: 0, b: 0 }, final: { r: 255, g: 255, b: 255 },
      linked: { r: false, g: false, b: false }, exportFormat: 'png', hexCount: 16777216
    };

    const elements = {
      ...['initial', 'final'].reduce((acc, type) => {
        ['r', 'g', 'b'].forEach(comp => acc[`${type}${comp.toUpperCase()}`] = document.getElementById(`${type}-${comp}`));
        acc[`${type}Preview`] = document.getElementById(`${type}-preview`);
        acc[`${type}Hex`] = document.getElementById(`${type}-hex`);
        return acc;
      }, {}),
      gradientPreview: document.getElementById('gradient-preview'),
      ...['r', 'g', 'b'].reduce((acc, comp) => (acc[`link${comp.toUpperCase()}`] = document.getElementById(`link-${comp}`), acc), {}),
      hexCount: document.getElementById('hex-count'), countWarning: document.getElementById('count-warning'),
      generateBtn: document.getElementById('generate-btn'), progressContainer: document.getElementById('progress-container'),
      progressFill: document.getElementById('progress-fill'), progressText: document.getElementById('progress-text'),
      toast: document.getElementById('toast')
    };

    // ========================================================================
    // UTILITY FUNCTIONS & COLOR CALCULATIONS
    // ========================================================================
    // This section contains optimized utility functions for color manipulation
    // and validation. It handles all color processing, hex validation, and
    // mathematical calculations needed throughout the application efficiently.
    const utils = {
      hexToRgb: hex => {
        const num = parseInt(hex.replace('#', ''), 16);
        return { r: (num >> 16) & 255, g: (num >> 8) & 255, b: num & 255 };
      },
      rgbToHex: (r, g, b) => '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase(),
      validateHex: value => value.replace(/[^0-9A-Fa-f]/g, '').toUpperCase().slice(0, 2),
      normalizeHex: value => utils.validateHex(value).padStart(2, '0'),
      calculateHexCount: () => {
        const initial = parseInt(utils.rgbToHex(state.initial.r, state.initial.g, state.initial.b).replace('#', ''), 16);
        const final = parseInt(utils.rgbToHex(state.final.r, state.final.g, state.final.b).replace('#', ''), 16);
        return initial === final ? 1 : Math.abs(final - initial) + 1;
      }
    };

    // ========================================================================
    // UI UPDATE FUNCTIONS
    // ========================================================================
    // This section handles all user interface updates with optimized functions
    // that maintain synchronization between application state and visual elements.
    // These functions provide real-time feedback and visual updates efficiently.
    const ui = {
      updateColorPreview: type => {
        const color = state[type];
        const hex = utils.rgbToHex(color.r, color.g, color.b);
        elements[`${type}Preview`].style.backgroundColor = hex;
        elements[`${type}Hex`].textContent = hex;
      },
      updateGradientPreview: () => {
        const initialHex = utils.rgbToHex(state.initial.r, state.initial.g, state.initial.b);
        const finalHex = utils.rgbToHex(state.final.r, state.final.g, state.final.b);
        elements.gradientPreview.style.background = `linear-gradient(180deg, ${initialHex}, ${finalHex})`;
      },
      updateHexCount: () => {
        const count = utils.calculateHexCount();
        state.hexCount = count;
        elements.hexCount.textContent = count.toLocaleString();
        
        const isOverLimit = count > 65536;
        const isAllRGB = count === 16777216;
        
        elements.countWarning.textContent = isOverLimit ? 'Oops! Exceeds 65,536.' : 
                                           isAllRGB ? "That's an allRGB spectrum!" : "Let's R-G-Begin!";
        elements.countWarning.style.color = isOverLimit ? 'var(--error-500)' : 'var(--success-500)';
        elements.countWarning.style.backgroundColor = isOverLimit ? 'var(--error-50)' : 'var(--primary-50)';
        elements.countWarning.style.borderColor = isOverLimit ? 'var(--error-200)' : 'var(--primary-200)';
        
        elements.generateBtn.disabled = isOverLimit;
        elements.generateBtn.style.opacity = isOverLimit ? '0.5' : '1';
      },
      showToast: message => {
        elements.toast.textContent = message;
        elements.toast.classList.add('show');
        setTimeout(() => elements.toast.classList.remove('show'), 3000);
      },
      updateLinkedValues: (component, value, isInitial) => {
        if (!state.linked[component]) return;
        const otherType = isInitial ? 'final' : 'initial';
        const input = elements[`${otherType}${component.toUpperCase()}`];
        input.value = value;
        state[otherType][component] = parseInt(value, 16);
        ui.updateColorPreview(otherType);
      }
    };

    // ========================================================================
    // EVENT LISTENERS & GENERATION CONTROL
    // ========================================================================
    // This section manages all user interactions with optimized event handlers
    // that process input validation, linking functionality, and generation workflow.
    // It coordinates all user actions and maintains application state efficiently.
    const events = {
      setupInputs: () => {
        ['r', 'g', 'b'].forEach(component => {
          ['initial', 'final'].forEach(type => {
            const input = elements[`${type}${component.toUpperCase()}`];
            
            const updateValue = () => {
              const value = utils.validateHex(input.value);
              input.value = value;
              const normalizedValue = utils.normalizeHex(value);
              state[type][component] = parseInt(normalizedValue, 16);
              ui.updateColorPreview(type);
              ui.updateGradientPreview();
              ui.updateHexCount();
              ui.updateLinkedValues(component, normalizedValue, type === 'initial');
            };
            
            input.addEventListener('input', updateValue);
            input.addEventListener('blur', () => {
              input.value = utils.normalizeHex(input.value);
              updateValue();
            });
          });
        });
      },
      
      setupLinks: () => {
        ['r', 'g', 'b'].forEach(component => {
          const btn = elements[`link${component.toUpperCase()}`];
          btn.addEventListener('click', () => {
            state.linked[component] = !state.linked[component];
            btn.classList.toggle('linked', state.linked[component]);
            
            if (state.linked[component]) {
              const value = elements[`initial${component.toUpperCase()}`].value;
              elements[`final${component.toUpperCase()}`].value = value;
              state.final[component] = state.initial[component];
              ui.updateColorPreview('final');
              ui.updateGradientPreview();
              ui.updateHexCount();
            }
          });
        });
      },
      
      setupExport: () => {
        document.querySelectorAll('.export-radio').forEach(radio => {
          radio.addEventListener('click', () => {
            document.querySelectorAll('.export-radio').forEach(r => r.classList.remove('selected'));
            radio.classList.add('selected');
            state.exportFormat = radio.dataset.format;
          });
        });
      },
      
      setupGenerate: () => {
        elements.generateBtn.addEventListener('click', () => {
          if (state.hexCount > 65536) {
            ui.showToast('Cannot generate more than 65,536 hexcodes!');
            return;
          }
          
          elements.generateBtn.disabled = true;
          elements.generateBtn.textContent = 'Generating...';
          elements.progressContainer.classList.add('show');
          elements.progressFill.style.width = '0%';
          
          parent.postMessage({
            pluginMessage: {
              type: 'generate-colors',
              initialColor: utils.rgbToHex(state.initial.r, state.initial.g, state.initial.b),
              finalColor: utils.rgbToHex(state.final.r, state.final.g, state.final.b),
              count: state.hexCount,
              exportFormat: state.exportFormat
            }
          }, '*');
        });
      }
    };

    // ========================================================================
    // PLUGIN COMMUNICATION & FILE HANDLING
    // ========================================================================
    // This section manages communication with the Figma plugin environment and
    // handles file operations including auto-export functionality. It processes
    // progress updates and coordinates data exchange between UI and plugin efficiently.
    const plugin = {
      handleMessage: event => {
        const message = event.data.pluginMessage;
        if (!message) return;
        
        switch (message.type) {
          case 'generation-progress':
            elements.progressFill.style.width = `${message.percentage}%`;
            elements.progressText.textContent = message.message;
            break;
          case 'generation-complete':
            elements.generateBtn.disabled = false;
            elements.generateBtn.textContent = 'Generate';
            elements.progressContainer.classList.remove('show');
            elements.progressFill.style.width = '100%';
            ui.showToast(`Generated ${message.count} colors successfully! (${message.gridSize} grid)`);
            break;
          case 'generation-error':
            elements.generateBtn.disabled = false;
            elements.generateBtn.textContent = 'Generate';
            elements.progressContainer.classList.remove('show');
            ui.showToast(`Error: ${message.error}`);
            break;
          case 'auto-export':
            const blob = new Blob([new Uint8Array(message.exportData)], 
                                 { type: message.format === 'png' ? 'image/png' : 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = message.filename;
            link.click();
            URL.revokeObjectURL(url);
            ui.showToast(`🎉 ${message.format.toUpperCase()} file exported successfully!`);
            break;
        }
      },
      
      init: () => {
        events.setupInputs();
        events.setupLinks();
        events.setupExport();
        events.setupGenerate();
        
        ui.updateColorPreview('initial');
        ui.updateColorPreview('final');
        ui.updateGradientPreview();
        ui.updateHexCount();
        
        window.addEventListener('message', plugin.handleMessage);
        parent.postMessage({ pluginMessage: { type: 'ui-ready' } }, '*');
      }
    };

    // ========================================================================
    // APPLICATION STARTUP
    // ========================================================================
    // This section initiates the plugin application with optimized startup sequence.
    // It ensures all components are properly initialized and ready for user
    // interaction when the plugin interface loads completely.
    plugin.init();
  </script>
</body>
</html> 